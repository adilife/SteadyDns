# Dashboard 功能后端数据需求

## 1. 系统概览统计

**功能说明**：显示系统的核心统计指标，包括总查询量、QPS、缓存命中率和系统健康度。

**数据结构**：
```json
{
  "systemStats": {
    "totalQueries": 12500,      // 总查询量（整数）
    "qps": 25.5,                // 当前 QPS（浮点数，保留1位小数）
    "cacheHitRate": 85.5,       // 缓存命中率（浮点数，保留1位小数）
    "systemHealth": 92,         // 系统健康度（整数，0-100）
    "activeServers": 5          // 活跃服务器数量（整数）
  }
}
```

**刷新频率**：建议 1-5 秒

## 2. 转发服务器状态

**功能说明**：显示外部转发服务器组（ID=1）的状态，包括每个服务器的 QPS、延迟和健康状态。

**数据结构**：
```json
{
  "forwardServers": [
    {
      "id": 1,                  // 服务器ID（整数）
      "address": "8.8.8.8",     // 服务器地址（字符串）
      "qps": 12.5,              // 服务器QPS（浮点数，保留1位小数）
      "latency": 15.2,          // 服务器延迟（浮点数，保留1位小数，单位：ms）
      "status": "healthy"       // 服务器状态（字符串："healthy" 或 "unhealthy"）
    }
    // 更多服务器...
  ]
}
```

**刷新频率**：建议 5-10 秒

## 3. 缓存状态

**功能说明**：显示后台服务器缓存的详细状态，包括缓存大小、最大容量、命中率和未命中率。

**数据结构**：
```json
{
  "cacheStats": {
    "size": "1.2 GB",           // 当前缓存大小（字符串，带单位）
    "maxSize": "2 GB",          // 最大缓存容量（字符串，带单位）
    "hitRate": 85,              // 缓存命中率（整数，0-100）
    "missRate": 15,             // 缓存未命中率（整数，0-100）
    "items": 150000             // 缓存项目数（整数）
  }
}
```

**刷新频率**：建议 10-30 秒

## 4. 系统资源使用情况

**功能说明**：显示服务器的系统资源使用情况，包括 CPU、内存、磁盘和网络使用率。

**数据结构**：
```json
{
  "systemResources": {
    "cpu": 45,                  // CPU使用率（整数，0-100）
    "memory": 68,               // 内存使用率（整数，0-100）
    "disk": 32,                 // 磁盘使用率（整数，0-100）
    "network": {
      "inbound": "12 MB/s",     // 入站网络流量（字符串，带单位）
      "outbound": "8 MB/s"      // 出站网络流量（字符串，带单位）
    }
  }
}
```

**刷新频率**：建议 5-15 秒

## 5. 热门域名 Top 10

**功能说明**：显示查询量最高的前 10 个目标域名，包括排名、域名、查询数和占比。

**数据结构**：
```json
{
  "topDomains": [
    {
      "rank": 1,                // 排名（整数）
      "domain": "example.com",  // 域名（字符串）
      "queries": 1250,          // 查询数（整数）
      "percentage": 10.2        // 占比（浮点数，保留1位小数）
    }
    // 更多域名...
  ]
}
```

**刷新频率**：建议 30-60 秒

## 6. 热门客户端 Top 10

**功能说明**：显示查询量最高的前 10 个客户端 IP，包括排名、IP 地址、查询数和占比。

**数据结构**：
```json
{
  "topClients": [
    {
      "rank": 1,                // 排名（整数）
      "ip": "192.168.1.100",    // 客户端IP（字符串）
      "queries": 1200,          // 查询数（整数）
      "percentage": 9.8         // 占比（浮点数，保留1位小数）
    }
    // 更多客户端...
  ]
}
```

**刷新频率**：建议 30-60 秒

## 7. QPS 趋势数据

**功能说明**：显示过去一段时间内的 QPS 变化趋势，用于图表展示。

**数据结构**：
```json
{
  "qpsTrend": [
    {
      "time": "00:00",          // 时间点（字符串，HH:MM格式）
      "qps": 12.5               // QPS值（浮点数，保留1位小数）
    }
    // 更多时间点...
  ]
}
```

**时间范围**：
- 1小时：每15分钟一个点（5个点）
- 6小时：每30分钟一个点（13个点）
- 24小时：每2小时一个点（13个点）
- 7天：每天一个点（7个点）

**刷新频率**：建议 1-5 分钟

## 8. 延迟分布数据

**功能说明**：显示不同延迟范围内的查询分布情况，用于柱状图展示。

**数据结构**：
```json
{
  "latencyData": [
    {
      "range": "<10ms",         // 延迟范围（字符串）
      "count": 45               // 占比（整数，0-100）
    },
    {
      "range": "10-20ms",
      "count": 30
    },
    {
      "range": "20-50ms",
      "count": 15
    },
    {
      "range": "50-100ms",
      "count": 8
    },
    {
      "range": ">100ms",
      "count": 2
    }
  ]
}
```

**刷新频率**：建议 1-5 分钟

## 9. 系统资源使用趋势

**功能说明**：显示过去一段时间内的系统资源使用变化趋势，包括 CPU、内存和磁盘使用率。

**数据结构**：
```json
{
  "resourceUsage": [
    {
      "time": "00:00",          // 时间点（字符串，HH:MM格式）
      "cpu": 30,                // CPU使用率（整数，0-100）
      "memory": 60,             // 内存使用率（整数，0-100）
      "disk": 30                // 磁盘使用率（整数，0-100）
    }
    // 更多时间点...
  ]
}
```

**时间范围**：
- 1小时：每15分钟一个点（5个点）
- 6小时：每30分钟一个点（13个点）
- 24小时：每2小时一个点（13个点）

**刷新频率**：建议 1-5 分钟

## API 设计建议

### 1. 综合数据 API

**端点**：`GET /api/dashboard/summary`

**返回**：包含所有静态数据的综合响应（systemStats, forwardServers, cacheStats, systemResources）

**缓存**：建议缓存 1-5 秒

### 2. 趋势数据 API

**端点**：`GET /api/dashboard/trends`

**参数**：
- `timeRange`：时间范围（可选，默认 1h，可选值：1h, 6h, 24h, 7d）

**返回**：包含所有趋势数据（qpsTrend, latencyData, resourceUsage）

**缓存**：建议缓存 1-5 分钟

### 3. 排行榜数据 API

**端点**：`GET /api/dashboard/top`

**参数**：
- `limit`：返回数量（可选，默认 10）

**返回**：包含热门域名和客户端数据（topDomains, topClients）

**缓存**：建议缓存 30-60 秒

## 刷新频率建议

1. **实时数据**（1-5 秒）：
   - 系统统计信息（QPS、总查询量）
   - 转发服务器状态

2. **准实时数据**（5-15 秒）：
   - 系统资源使用情况

3. **低频数据**（30-60 秒）：
   - 缓存状态
   - 排行榜数据

4. **趋势数据**（1-5 分钟）：
   - QPS 趋势
   - 延迟分布
   - 资源使用趋势

## 错误处理建议

- 当 API 调用失败时，返回适当的 HTTP 状态码（如 500 表示服务器错误）
- 提供清晰的错误消息
- 对于部分数据不可用的情况，返回可用的数据部分，而不是整个请求失败

## 数据精度建议

- QPS 和延迟：保留 1 位小数
- 百分比值：保留 1 位小数
- 整数类型：使用适当的整数范围
- 字符串类型：确保格式一致（如时间格式、单位格式）
